@model Mini_Project_Assignment_Y2S2.Models.EditProfileViewModel

@{
	ViewBag.Title = "Edit Profile";
}
<link rel="stylesheet" href="~/css/user.css" asp-append-version="true" />

<div class="container">
    <div class="login-card">
        <div class="login-title">Edit Profile</div>

        <form asp-action="EditProfile" method="post" enctype="multipart/form-data">

            <div class="profile-pic-container">
                <input value=@Model.ProfileImageUrl asp-for="ProfileImageUrl" hidden>
                @if (Model?.ProfileImageUrl != null && !string.IsNullOrEmpty(Model.ProfileImageUrl))
                {
                    <img "id="profilePreview" src="@Model.ProfileImageUrl" alt="Profile" class="profile-pic" />
                }
                else
                {
                    <div id="profilePlaceholder" class="profile-placeholder">
                        Click to Add Picture
                    </div>
                }

                <input type="file" name="ProfileImage" accept="image/*" id="profileInput" hidden />
            </div>

            <div class="form-group">
                <label asp-for="Name"></label>
                <input asp-for="Name" class="form-control" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="Email"></label>
                <input asp-for="Email" class="form-control" />
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="PhoneNumber"></label>
                <input asp-for="PhoneNumber" class="form-control" />
                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
            </div>

            <button type="button" onclick="location.href='@Url.Action("MyAccount")'" class="btn-cancel">Cancel</button>
            <button type="submit" class="btn-change">Save Changes</button>

        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

<style>
    .profile-pic-container {
        width: 140px;
        height: 140px;
        border-radius: 50%;
        margin: 0 auto 20px auto;
        overflow: hidden;
        cursor: pointer;
        border: 3px solid #ccc;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 14px;
        color: #666;
        background-color: #f0f0f0;
        text-align: center;
        transition: 0.3s;
    }

        .profile-pic-container:hover {
            opacity: 0.8;
        }

    .profile-pic {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .profile-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

</style>

<script>
    const profileInput = document.getElementById('profileInput');
    const profileContainer = document.querySelector('.profile-pic-container');
    const profilePreview = document.getElementById('profilePreview');
    const profilePlaceholder = document.getElementById('profilePlaceholder');

    profileContainer.addEventListener('click', function () {
        profileInput.click();
    });

    profileInput.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
            const url = URL.createObjectURL(file);

            if (profilePreview) {
                profilePreview.src = url;
            } else if (profilePlaceholder) {
                // Replace placeholder with image
                profilePlaceholder.remove();
                const img = document.createElement('img');
                img.id = 'profilePreview';
                img.src = url;
                img.classList.add('profile-pic');
                profileContainer.prepend(img);
            }
        }
    });

</script>