@model Mini_Project_Assignment_Y2S2.Models.CardDetailsViewModel

@{
    ViewData["Title"] = "My Post Details";
}

<link rel="stylesheet" href="~/css/cardDetails.css" asp-append-version="true" />
<div class="parent">

    <div class="top-actions" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <!-- Back button -->
        <a class="back" href="@Url.Action("MyPost", "User")">Back</a>

        <!-- Owner Actions (Edit / Mark Claimed) -->
        <div class="owner-actions" style="display:flex; gap:10px; align-items:center;">
            <a class="btn-edit"
               asp-action="EditPost"
               asp-controller="User"
               asp-route-itemId="@Model.Item.ItemID">
                ✏ Edit
            </a>

            @if (!Model.IsClaimed)
            {
                <form asp-action="MarkClaimed"
                      asp-controller="User"
                      method="post"
                      onsubmit="return confirm('Mark this item as CLAIMED?');"
                      style="margin:0;">
                    <input type="hidden" name="itemId" value="@Model.Item.ItemID" />
                    <button type="submit" class="btn-claimed">
                        ✔ Claimed
                    </button>
                </form>
            }
            else
            {
                <span class="claimed-badge">🏁 CLAIMED</span>
            }
        </div>
    </div>

    <div class="CardDetails">

        <!-- ================= TOP SECTION ================= -->
        <div class="topDetails">

            <!-- 🖼 IMAGE CAROUSEL -->
            <div class="image">
                <div class="carousel-container">

                    @if (Model.Item.Images != null && Model.Item.Images.Any())
                    {
                        <img id="carouselImage"
                             src="@Model.Item.Images[0]"
                             style="width:100%; height:100%; object-fit:cover; border-radius:6px;" />

                        @if (Model.Item.Images.Count > 1)
                        {
                            <button id="prevBtn" class="carousel-btn prev">&#10094;</button>
                            <button id="nextBtn" class="carousel-btn next">&#10095;</button>
                        }
                    }
                    else
                    {
                        <img src="/images/default.png"
                             style="width:100%; height:100%; object-fit:cover; border-radius:6px;" />
                    }
                </div>
            </div>

            <!-- 👤 USER DETAILS -->
            <div class="userDetails">
                <p class="UserDetails">User Details</p>

                <p class="label">Name</p>
                <p class="text">@Model.User.Name</p>

                <p class="label">Contact Number</p>
                <p class="text">@Model.User.PhoneNumber</p>

                <p class="label">Email</p>
                <p class="text">@Model.User.Email</p>

                <p class="label">Item Keep At</p>
                <p class="text">@Model.Location.LocationName</p>
            </div>

        </div>

       

        <!-- ================= BOTTOM DETAILS ================= -->
        <div class="bottomDetails">

            <div class="bottomDetails-left">

                <div class="bottomDetails-left2">
                    <p class="label">Date</p>
                    <p class="text">@Model.Item.Date.ToString("dd/MM/yyyy")</p>

                    <p class="label">Type</p>
                    <p class="text">@Model.Item.IType</p>

                    <p class="label">Category</p>
                    <p class="text">@Model.Item.Category</p>
                </div>

                <div class="bottomDetails-right2">
                    <p class="label">Location</p>
                    <p class="text">@Model.Item.LocationFound</p>
                </div>

            </div>

            <div class="bottomDetails-right">
                <p class="label">Description</p>
                <p class="text">@Model.Item.Idescription</p>
            </div>

        </div>

    </div>
</div>

<!-- ================= IMAGE CAROUSEL SCRIPT ================= -->
<script>
    let images = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Item.Images ?? new List<string>()));
    let currentIndex = 0;

    const carouselImage = document.getElementById("carouselImage");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    if (prevBtn && nextBtn) {
        prevBtn.addEventListener("click", () => {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            carouselImage.src = images[currentIndex];
        });

        nextBtn.addEventListener("click", () => {
            currentIndex = (currentIndex + 1) % images.length;
            carouselImage.src = images[currentIndex];
        });
    }
</script>
