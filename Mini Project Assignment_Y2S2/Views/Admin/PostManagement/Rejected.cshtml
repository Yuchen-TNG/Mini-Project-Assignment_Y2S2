@model IEnumerable<Mini_Project_Assignment_Y2S2.Models.Item>

@{
    ViewData["Title"] = "Rejected Posts";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="mb-6 flex items-center justify-between">
    <div>
        <h2 class="text-xl font-bold">Rejected Posts</h2>
        <p class="text-gray-400 text-sm">View all rejected posts</p>
    </div>
    <a href="@Url.Action("Index", "PostManagement")" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">
        <i class="fas fa-arrow-left mr-2"></i> Back to Pending
    </a>
</div>

@if (TempData["Error"] != null)
{
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        @TempData["Error"]
    </div>
}

<div class="bg-white rounded-lg p-4 mb-6 shadow-sm">
    <form method="get" class="flex gap-4 items-center">
        <div class="flex-1">
            <input type="text"
                   name="search"
                   value="@ViewBag.Search"
                   placeholder="Search by name, type, description, or location..."
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
            <select name="category"
                    class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">All Categories</option>
                @if (ViewBag.Category == "LOSTITEM")
                {
                    <option value="LOSTITEM" selected>Lost Items</option>
                }
                else
                {
                    <option value="LOSTITEM">Lost Items</option>
                }
                @if (ViewBag.Category == "FOUNDITEM")
                {
                    <option value="FOUNDITEM" selected>Found Items</option>
                }
                else
                {
                    <option value="FOUNDITEM">Found Items</option>
                }
            </select>
        </div>
        <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition">
            <i class="fas fa-search mr-2"></i> Search
        </button>
    </form>
</div>

@if (Model != null && Model.Any())
{
    <div class="space-y-6">
        @foreach (var item in Model)
        {
            <div class="bg-gray-200 rounded-lg p-4 flex gap-6 shadow-sm">
                <div class="w-40 h-40 bg-gray-300 rounded flex items-center justify-center shrink-0 overflow-hidden">
                    @if (item.Images != null && item.Images.Any())
                    {
                        <img src="@item.Images[0]" alt="Item Image" class="w-full h-full object-cover" />
                    }
                    else
                    {
                        <i class="far fa-image text-4xl text-gray-400"></i>
                    }
                </div>
                <div class="flex-1 py-2">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-lg">@item.IType</h3>
                        <div class="flex gap-2 items-center">
                            <span class="text-xs font-bold uppercase px-2 py-1 rounded bg-white text-gray-600">
                                @item.Category
                            </span>
                            <span class="text-xs font-bold uppercase px-2 py-1 rounded bg-red-100 text-red-800">
                                <i class="fas fa-times-circle mr-1"></i> Rejected
                            </span>
                        </div>
                    </div>
                    <p class="text-gray-600 text-sm mb-4 leading-relaxed">
                        @item.Idescription
                    </p>
                    <p class="text-xs text-gray-400 mb-2">
                        Location: <span class="font-medium">@(item.LocationFound ?? "N/A")</span>
                    </p>
                    <p class="text-xs text-gray-400 mb-4">
                        Posted on: @item.Date.ToString("dd MMM yyyy")
                    </p>
                    <div>
                        <a href="@Url.Action("ViewDetails", "PostManagement", new { itemId = item.ItemID })"
                           class="bg-blue-500 text-white px-6 py-1.5 rounded shadow-sm hover:bg-blue-600 font-medium transition inline-block">
                            View Details
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>

    @if (ViewBag.TotalPages > 1)
    {
        <div class="mt-6 flex justify-center items-center gap-2">
            <p class="text-sm text-gray-500 mr-4">Page @ViewBag.CurrentPage of @ViewBag.TotalPages (@ViewBag.TotalCount items)</p>

            @if (ViewBag.CurrentPage > 1)
            {
                <a href="@Url.Action("Rejected", new { page = ViewBag.CurrentPage - 1, search = ViewBag.Search, category = ViewBag.Category })"
                   class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">
                    Previous
                </a>
            }

            @for (int i = Math.Max(1, ViewBag.CurrentPage - 2); i <= Math.Min(ViewBag.TotalPages, ViewBag.CurrentPage + 2); i++)
            {
                <a href="@Url.Action("Rejected", new { page = i, search = ViewBag.Search, category = ViewBag.Category })"
                   class="px-4 py-2 rounded @(i == ViewBag.CurrentPage ? "bg-blue-500 text-white" : "bg-gray-200 hover:bg-gray-300")">
                    @i
                </a>
            }

            @if (ViewBag.CurrentPage < ViewBag.TotalPages)
            {
                <a href="@Url.Action("Rejected", new { page = ViewBag.CurrentPage + 1, search = ViewBag.Search, category = ViewBag.Category })"
                   class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">
                    Next
                </a>
            }
        </div>
    }
}
else
{
    <div class="text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300">
        <i class="fas fa-times-circle text-4xl text-gray-300 mb-3"></i>
        <p class="text-gray-500">No rejected posts found.</p>
    </div>
}
